name: Node.js and Vite CI

on:
  push:
    branches:
      - main  # Trigger CI on pushes to the main branch


jobs:
  backend:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Use Node.js 20
      uses: actions/setup-node@v4
      with:
        node-version: 20
    - name: Install dependencies
      working-directory: ./backend
      run: npm install
    - name: List files in backend
      working-directory: ./backend
      run: ls -la
    - name: Build backend
      working-directory: ./backend
      run: npm run build
    - name: Test backend
      working-directory: ./backend
      run: npm test
      env:
        MONGODB_URI: ${{ secrets.MONGODB_URI }}
        JWT_SECRET: ${{ secrets.JWT_SECRET }}

  frontend:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Use Node.js 20
      uses: actions/setup-node@v4
      with:
        node-version: 20
    - name: Install dependencies
      working-directory: ./frontend
      run: npm install
    - name: List files in frontend
      working-directory: ./frontend
      run: ls -la
    - name: Build frontend
      working-directory: ./frontend
      run: npm run build
      env:
        VITE_API_BASE_URL: ${{ secrets.VITE_API_BASE_URL }}